generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Style {
  id                BigInt        @id @default(autoincrement()) // 고유 값
  title             String        // 게시글 제목
  author            String        // 작성자(닉네임)
  description       String        // 스타일 설명
  password          String        // 비밀번호
  created_at        DateTime      @default(now()) @db.Timestamptz(6)  // 생성 일자
  updated_at        DateTime      @updatedAt @db.Timestamptz(6)       // 수정 일자
  views             Int           @default(0) // 조회수 (기본 값 0)
  curation_count    Int           @default(0) // 큐레이팅 수 (정렬 기준 검색을위해...) (기본 값 0)

  tags              StyleTag[]    // 스타일 태그 최대3개
  items             StyleItem[]   // 스타일 구성(상의 하의 아우터 등...)
  curations         Curation[]    // 큐레이팅 목록
  images            StyleImage[]  // 스타일 이미지

  @@index([created_at])
  @@index([views])
  @@index([curation_count])
}

model Tag {
  id     BigInt     @id @default(autoincrement())
  name   String     @unique
  styles StyleTag[]
}

model StyleTag {
  id         BigInt   @id @default(autoincrement())
  style_id   BigInt
  tag_id     BigInt
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  style      Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([style_id, tag_id])
  @@index([tag_id])
}

model StyleItem {
  id         BigInt        @id @default(autoincrement())
  style_id   BigInt
  item_name  String
  brand_name String
  category   StyleCategory
  price      Int
  created_at DateTime      @default(now()) @db.Timestamptz(6)
  updated_at DateTime      @updatedAt @db.Timestamptz(6)
  style      Style         @relation(fields: [style_id], references: [id], onDelete: Cascade)

  @@unique([style_id, category])
}

model StyleImage {
  id         BigInt   @id @default(autoincrement())
  style_id   BigInt
  name       String
  path       String
  size       Int
  order      Int
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  style      Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
}

model Curation {
  id                 BigInt   @id @default(autoincrement())
  style_id           BigInt
  nickname           String
  content            String
  password           String
  trendy             Int      @default(0)
  personality        Int      @default(0)
  practicality       Int      @default(0)
  costEffectiveness  Int      @default(0)
  created_at         DateTime @default(now()) @db.Timestamptz(6)
  updated_at         DateTime @updatedAt @db.Timestamptz(6)
  style              Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
  reply              Reply?
}

model Reply {
  id          BigInt   @id @default(autoincrement())
  curation_id BigInt   @unique
  password    String
  nickname    String
  content     String
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)
  curation    Curation @relation(fields: [curation_id], references: [id], onDelete: Cascade)
}

enum StyleCategory {
  TOP
  BOTTOM
  OUTER
  ONEPIECE
  SHOES
  BAG
  ACCESSORY
}
