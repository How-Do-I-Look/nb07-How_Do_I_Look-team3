generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Style {
  id             BigInt       @id @default(autoincrement())
  title          String
  author         String
  description    String
  password       String
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  updated_at     DateTime     @updatedAt @db.Timestamptz(6)
  views          Int          @default(0)
  curation_count Int          @default(0)
  curations      Curation[]
  images         StyleImage[]
  items          StyleItem[]
  tags           StyleTag[]

  @@index([created_at])
  @@index([views])
  @@index([curation_count])
}

model Tag {
  id     BigInt     @id @default(autoincrement())
  name   String     @unique
  styles StyleTag[]
}

model StyleTag {
  id         BigInt   @id @default(autoincrement())
  style_id   BigInt
  tag_id     BigInt
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  style      Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([style_id, tag_id])
  @@index([tag_id])
}

model StyleItem {
  id         BigInt        @id @default(autoincrement())
  style_id   BigInt
  item_name  String
  brand_name String
  category   StyleCategory
  price      Int
  created_at DateTime      @default(now()) @db.Timestamptz(6)
  updated_at DateTime      @updatedAt @db.Timestamptz(6)
  style      Style         @relation(fields: [style_id], references: [id], onDelete: Cascade)

  @@unique([style_id, category])
}

model StyleImage {
  id         BigInt   @id @default(autoincrement())
  style_id   BigInt
  name       String
  path       String
  size       Int
  order      Int
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  style      Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
}

model Curation {
  id           BigInt   @id @default(autoincrement())
  style_id     BigInt
  author       String
  content      String
  password     String
  trendy       Int      @default(0)
  personality  Int      @default(0)
  practicality Int      @default(0)
  performance  Int      @default(0)
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @updatedAt @db.Timestamptz(6)
  style        Style    @relation(fields: [style_id], references: [id], onDelete: Cascade)
  reply        Reply?
}

model Reply {
  id          BigInt   @id @default(autoincrement())
  curation_id BigInt   @unique
  password    String
  author      String
  content     String
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)
  curation    Curation @relation(fields: [curation_id], references: [id], onDelete: Cascade)
}

enum StyleCategory {
  TOP
  BOTTOM
  OUTER
  ONEPIECE
  SHOES
  BAG
  ACCESSORY
}
